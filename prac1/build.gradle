/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at https://docs.gradle.org/4.9/userguide/tutorial_java_projects.html
 */

plugins {
    // Apply the java plugin to add support for Java
    id 'java'

    // Apply the application plugin to add support for building an application
    id 'application'

    // Apply the download plugin for downloading db4o
    id "de.undercouch.download" version "3.4.3"
}

// Define the main class for the application
mainClassName = 'App'

dependencies {
    compile name: 'db4o-8.0.249.16098-all-java5'
}

// In this section you declare where to find the dependencies of your project
repositories {
    // Use jcenter for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()

    flatDir {
        dirs 'lib'
    }

}

// Source: https://www.mkyong.com/gradle/gradle-create-a-jar-file-with-dependencies/
// Create a single Jar with all dependencies
task fatJar(type: Jar) {
	manifest {
        attributes (
        	'Main-Class': mainClassName
        )
    }
    baseName = project.name + '-all'
    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
    with jar
}

// Source: https://github.com/michel-kraemer/gradle-download-task

// If there is a more elegant method, please let me know
task downloadZipFile(type: Download) {
    // TODO(egeldenhuys): Download only jar file
    src 'https://www.cs.up.ac.za/files/COS326/Download/3743/'
    dest new File(buildDir, 'db4o-8.0.zip')

    // If there are errors in task verifyFile, set to true
    overwrite false
}

task verifyFile(type: Verify, dependsOn: downloadZipFile) {
    src downloadZipFile.dest
    algorithm 'MD5'
    checksum 'db5f9954d9d1abafebb0cb26b2662ffd'
}

task extractDb4o(type: Copy, dependsOn: verifyFile) {
    // Uncomment if all steps pass, but no .jar in lib folder
    // outputs.upToDateWhen { false }

    from zipTree(downloadZipFile.dest)
    into buildDir
    include 'db4o-8.0/lib/db4o-8.0.249.16098-all-java5.jar'
}

task installDb4o(type: Copy, dependsOn: extractDb4o) {
    from "${buildDir}/db4o-8.0/lib"
    include 'db4o-8.0.249.16098-all-java5.jar'
    into 'lib'
}